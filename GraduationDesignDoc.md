# AFitness 智能健身管理系统 - 毕业设计文档

## 摘要
随着人们生活水平的提高和健康意识的增强，健身已成为大众生活的重要组成部分。然而，传统的健身管理方式往往依赖于纸笔记录或简单的记事本，难以进行科学的数据分析和个性化的计划制定。本项目设计并开发了一款基于 Vue 3 和 Spring Boot 的前后端分离架构的智能健身管理系统——AFitness。该系统通过 1RM 计算器、科学的训练计划制定、实时的负荷分析以及营养追踪等功能，为用户提供全方位的健身指导和数据支持。

## 第一章 绪论
### 1.1 研究背景与意义
*   健身行业的数字化趋势
*   科学健身与数据追踪的重要性
*   传统健身记录方式的局限性
### 1.2 国内外研究现状
*   国外知名健身 App (如 MyFitnessPal, Strava) 的功能分析
*   国内健身管理平台 (如 Keep) 的特点
### 1.3 主要研究内容
*   基于 Vue 3 + Vant 的移动端优先设计
*   基于 Spring Boot + JWT 的安全后端架构
*   科学的训练负荷分析算法实现

## 第二章 相关技术综述
### 2.1 前端技术
*   Vue 3 组合式 API (Composition API)
*   Pinia 状态管理
*   Vant 移动端组件库
*   ECharts 数据可视化
### 2.2 后端技术
*   Spring Boot 3.x 框架
*   Spring Security + JWT 安全认证
*   Hibernate/JPA 持久层框架
*   MySQL 数据库
### 2.3 开发工具与环境
*   Visual Studio Code / IntelliJ IDEA
*   Maven 项目构建工具
*   Git 版本控制

## 第三章 系统需求分析
### 3.1 功能需求分析
*   **用户管理**：注册、登录、个人资料编辑、密码修改、目标设定。
*   **训练管理**：训练数据录入（重量、组数、次数）、历史记录查询。
*   **训练计划**：计划制定、动作库选择、计划执行状态追踪。
*   **负荷分析**：1RM 计算（Epley, Brzycki 等公式）、训练量趋势分析、恢复状态评估。
*   **营养追踪**：饮食记录、卡路里计算、宏量营养素分析。
### 3.2 非功能需求分析
*   安全性：JWT 认证，数据加密存储。
*   易用性：移动端适配，直观的数据可视化。
*   性能：高效的 API 响应，数据库索引优化。

## 第四章 系统设计
### 4.1 系统架构设计
*   前后端分离架构图
*   MVC 模式在后端的应用
### 4.2 数据库设计
*   E-R 图设计
*   数据表结构详细设计 (users, fitness_data, training_plans, nutrition_records 等)
### 4.3 核心功能流程设计
*   用户认证流程 (JWT 流程)
*   训练负荷计算逻辑流程
*   训练计划制定与执行流程

## 第五章 系统实现
### 5.1 后端核心功能实现
*   **统一响应格式封装**：使用 `ApiResponse` 类统一封装后端返回结果，包含状态码、消息和数据负载，确保前端处理的一致性。
*   **安全认证体系**：基于 JWT (JSON Web Token) 的认证机制。通过 `JwtAuthenticationFilter` 拦截请求，解析 Token 并将用户 ID 存入 Request 属性。使用自定义注解 `@RequireUser` 和 `@RequireAdmin` 配合 `PermissionInterceptor` 实现方法级别的权限控制。
*   **控制层标准化设计**：所有 Controller 继承 `BaseController`，通过 `getUserIdFromRequest` 方法安全地从 Request 属性中获取当前登录用户 ID，避免了对 `SecurityContextHolder` 的直接依赖，提高了代码的可测试性和安全性。
*   **负荷分析算法**：在 `LoadRecoveryService` 中实现了多种 1RM (一次最大重复重量) 计算公式（如 Epley 和 Brzycki 公式），并结合用户的训练历史数据计算训练负荷趋势。
*   **技术难点攻克**：在营养统计模块中，通过提取私有方法 `generateNutritionAdvice` 成功解决了 `getNutritionStatsByDate` 与 `getNutritionAdvice` 之间的无限递归调用问题，提升了系统的稳定性和响应速度。
*   **数据库持久化**：使用 Spring Data JPA 进行数据操作，通过实体关联（OneToMany, ManyToOne）建立用户、训练计划、训练记录和营养数据之间的逻辑关系。

### 5.2 前端核心功能实现
*   **API 服务封装**：在 `api/fitness.js` 中封装了统一的 `fitnessApi` 对象，将所有后端接口映射为前端方法。结合 Axios 拦截器，自动在请求头中注入 JWT Token，并统一处理 401 未授权等错误状态。
*   **状态管理与持久化**：使用 Pinia 管理用户登录状态、个人资料以及全局配置。通过本地存储实现 Token 的持久化，确保用户刷新页面后仍保持登录状态。
*   **数据可视化展示**：集成 ECharts 图表库，在 `LoadAnalysis.vue` 和 `NutritionTracking.vue` 中动态展示训练强度分布、负荷趋势和营养素摄入比例，为用户提供直观的反馈。
*   **响应式交互设计**：利用 Vue 3 的 `ref` 和 `reactive` 实现高效的数据双向绑定。结合 Vant UI 组件库的表单验证、弹出层和列表组件，打造流畅的移动端用户体验。

### 5.3 数据库初始化与迁移
*   项目提供了完整的 SQL 脚本（`database_schema_h2.sql` 和 `mysql_database_init.sql`），涵盖了从用户基础表到复杂的训练计划和营养记录表的设计。
*   针对查询频繁的字段（如 `user_id` 和 `timestamp`）建立了复合索引，优化了大数据量下的查询性能。

## 第六章 系统测试
### 6.1 测试环境
*   **前端**：Node.js 18+, Vite 5.2+
*   **后端**：Java 17, Spring Boot 3.2.5
*   **数据库**：MySQL 8.0 / H2 (内存数据库用于快速开发)
*   **测试工具**：Postman (接口测试), Chrome DevTools (前端调试)

### 6.2 自动化集成测试
本系统采用了 Spring Boot Test 结合 MockMvc 的方式实现了完整的集成测试覆盖。
1.  **用户中心测试 (`UserControllerIntegrationTest`)**：验证了用户登录、个人信息获取以及管理员权限校验等功能。
2.  **训练记录测试 (`TrainingRecordControllerIntegrationTest`)**：验证了 API 路径统一化（`/api/v1`）后的记录查询功能，确保认证上下文正确注入。
3.  **1RM 计算测试 (`LoadRecoveryControllerIntegrationTest`)**：验证了 Epley、Brzycki 等多种公式的计算准确性及其 API 端点的稳定性。
4.  **营养追踪测试 (`NutritionControllerTest`)**：验证了在修复无限递归 Bug 后的饮食记录添加与统计功能。
5.  **训练计划测试 (`TrainingPlanControllerIntegrationTest`)**：验证了计划的创建、查询及详情展示逻辑。

### 6.3 功能测试案例
1.  **用户认证测试**：
    *   输入正确的用户名密码 -> 成功登录并获取 Token。
    *   使用无效 Token 访问受保护接口 -> 返回 401 错误。
    *   管理员访问普通用户接口 -> 正常访问。
    *   普通用户访问管理员接口 -> 返回 403 权限不足。
2.  **1RM 计算测试**：
    *   输入 100kg, 5次 -> 根据 Epley 公式计算结果应接近 116.7kg。
    *   输入非法数值 -> 前端表单拦截并提示错误。
3.  **训练计划管理测试**：
    *   创建新计划 -> 数据库 `training_plans` 表新增记录。
    *   将计划分配给用户 -> 计划在用户的“我的计划”列表中显示。
    *   标记动作完成 -> 状态实时更新并同步至后端。

### 6.3 联调与优化
*   解决了前后端跨域访问问题（CORS 配置）。
*   标准化了接口路径前缀为 `/api/v1`，确保了 API 版本管理的规范性。
*   优化了用户头像上传流程，实现了文件存储与数据库记录的联动。

## 第七章 总结与展望
### 7.1 本文工作总结
本项目成功设计并实现了一个基于前后端分离架构的智能健身管理系统。
1.  **架构设计**：采用 Vue 3 (Composition API) + Spring Boot 3 的现代技术栈，实现了高性能、高可维护性的系统。
2.  **核心算法**：实现了多种 1RM 估算公式和科学的训练负荷分析，为用户提供专业的数据支持。
3.  **安全性**：基于 JWT 和拦截器实现了完善的认证与授权体系，确保用户数据的安全性。
4.  **工程实践**：通过标准化的 RESTful API 设计、统一的版本管理（`/api/v1`）以及完善的自动化集成测试，体现了良好的软件工程素养。
5.  **问题解决**：在开发过程中成功解决了跨域访问、复杂的递归调用及数据库性能优化等技术难点。
### 7.2 系统不足与改进建议
### 7.3 未来展望

## 参考文献
## 致谢
