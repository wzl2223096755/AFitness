/* 移动端性能和体验优化 */

/* =====================================================
   触摸设备优化
   ===================================================== */
@media (hover: none) and (pointer: coarse) {
  /* 增加触摸目标大小 - 符合WCAG 2.1标准 (最小44x44px) */
  .el-button,
  .el-select,
  .el-input,
  .el-date-editor,
  .card,
  .stat-card,
  .el-checkbox,
  .el-radio,
  .el-switch {
    min-height: 44px;
    min-width: 44px;
  }
  
  /* 移除hover效果，使用active状态 */
  .card:hover,
  .stat-card:hover,
  .el-button:hover {
    transform: none;
  }
  
  .card:active,
  .stat-card:active,
  .el-button:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }
  
  /* 优化触摸反馈 */
  .el-button,
  .card,
  .stat-card,
  .menu-item,
  .nav-item,
  .clickable {
    -webkit-tap-highlight-color: rgba(99, 102, 241, 0.2);
    touch-action: manipulation;
    user-select: none;
  }
  
  /* 增加表单元素间距 */
  .el-form-item {
    margin-bottom: 24px;
  }
  
  /* 优化下拉选择器触摸区域 */
  .el-select-dropdown__item {
    min-height: 48px;
    line-height: 48px;
    padding: 0 16px;
  }
}

/* =====================================================
   移动端滚动优化
   ===================================================== */
@media (max-width: 768px) {
  /* 平滑滚动 */
  .main-content,
  .page-content,
  .sidebar-menu,
  .el-dialog__body,
  .el-table__body-wrapper {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
  
  /* 防止过度滚动 */
  .app-container {
    overscroll-behavior: contain;
  }
  
  /* 优化滚动性能 */
  .chart-container,
  .data-table {
    will-change: transform;
    contain: layout style paint;
  }
  
  /* 隐藏滚动条但保持功能 */
  .sidebar-menu::-webkit-scrollbar,
  .page-content::-webkit-scrollbar {
    width: 4px;
  }
  
  .sidebar-menu::-webkit-scrollbar-thumb,
  .page-content::-webkit-scrollbar-thumb {
    background: rgba(99, 102, 241, 0.3);
    border-radius: 2px;
  }
}

/* =====================================================
   移动端动画优化
   ===================================================== */
@media (max-width: 768px) {
  /* 减少复杂动画 */
  .stat-card::before {
    animation-duration: 4s;
  }
  
  /* 简化过渡效果 */
  .card,
  .stat-card,
  .el-button {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  /* 禁用不必要的动画 */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}

/* =====================================================
   移动端字体优化
   ===================================================== */
@media (max-width: 480px) {
  /* 确保文本可读性 */
  body {
    font-size: 16px;
    line-height: 1.5;
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
  }
  
  /* 防止文本缩放 - 避免iOS自动缩放 */
  input,
  textarea,
  select,
  .el-input__inner,
  .el-textarea__inner {
    font-size: 16px !important;
  }
  
  /* 优化标题显示 */
  h1, .page-header h1 {
    font-size: 22px;
    line-height: 1.3;
  }
  
  h2 {
    font-size: 18px;
    line-height: 1.3;
  }
  
  h3, .card-header h3 {
    font-size: 16px;
    line-height: 1.3;
  }
  
  /* 优化段落文本 */
  p, .page-description {
    font-size: 14px;
    line-height: 1.6;
  }
}

/* =====================================================
   移动端图片优化
   ===================================================== */
@media (max-width: 768px) {
  img {
    max-width: 100%;
    height: auto;
    object-fit: cover;
  }
  
  /* 懒加载优化 */
  .lazy-image {
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .lazy-image.loaded {
    opacity: 1;
  }
  
  /* 图片容器响应式 */
  .image-container,
  .avatar-wrapper {
    max-width: 100%;
    overflow: hidden;
  }
}

/* =====================================================
   移动端表单优化 - 核心改进
   ===================================================== */
@media (max-width: 768px) {
  /* 表单项垂直布局 */
  .el-form-item {
    margin-bottom: 20px;
  }
  
  /* 标签样式优化 */
  .el-form-item__label {
    font-size: 14px;
    line-height: 1.4;
    padding-bottom: 8px;
    text-align: left !important;
    float: none !important;
    display: block !important;
    width: 100% !important;
  }
  
  /* 表单内容区域 */
  .el-form-item__content {
    margin-left: 0 !important;
    width: 100%;
  }
  
  /* 输入框样式优化 */
  .el-input__inner,
  .el-textarea__inner {
    font-size: 16px;
    padding: 12px 14px;
    border-radius: 10px;
    min-height: 48px;
    box-sizing: border-box;
  }
  
  /* 数字输入框优化 */
  .el-input-number {
    width: 100%;
  }
  
  .el-input-number .el-input__inner {
    text-align: center;
  }
  
  .el-input-number__decrease,
  .el-input-number__increase {
    width: 44px;
    height: 100%;
  }
  
  /* 选择器优化 */
  .el-select {
    width: 100%;
  }
  
  .el-select .el-input__inner {
    padding-right: 40px;
  }
  
  /* 移动端友好的选择器下拉 */
  .el-select-dropdown {
    font-size: 16px;
    max-height: 50vh;
  }
  
  .el-select-dropdown__item {
    height: 48px;
    line-height: 48px;
    padding: 0 16px;
    font-size: 15px;
  }
  
  /* 日期选择器优化 */
  .el-date-editor {
    width: 100% !important;
  }
  
  .el-date-editor .el-input__inner {
    padding-left: 40px;
  }
  
  /* 评分组件优化 */
  .el-rate {
    height: 32px;
    display: flex;
    align-items: center;
  }
  
  .el-rate__item {
    margin-right: 8px;
  }
  
  .el-rate__icon {
    font-size: 24px;
  }
  
  /* 表单按钮组优化 */
  .form-actions,
  .el-form-item:last-child .el-form-item__content {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .form-actions .el-button,
  .el-form-item:last-child .el-button {
    width: 100%;
    margin: 0;
    height: 48px;
    font-size: 16px;
  }
  
  /* 表单行响应式 */
  .el-row {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  .el-col {
    padding-left: 0 !important;
    padding-right: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    flex: 0 0 100% !important;
    margin-bottom: 0;
  }
  
  /* 表单卡片优化 */
  .form-card,
  .data-form {
    padding: 16px;
    border-radius: 12px;
  }
  
  .form-card .card-header,
  .data-form .form-title {
    margin-bottom: 16px;
  }
}

/* =====================================================
   移动端表格优化
   ===================================================== */
@media (max-width: 768px) {
  .el-table {
    font-size: 13px;
  }
  
  .el-table .cell {
    padding: 10px 8px;
    word-break: break-word;
  }
  
  /* 小屏幕下表格横向滚动 */
  .el-table--scrollable-x .el-table__body-wrapper {
    -webkit-overflow-scrolling: touch;
  }
  
  /* 表格容器优化 */
  .data-table,
  .recent-records {
    padding: 12px;
    overflow-x: auto;
  }
  
  /* 表格头部响应式 */
  .data-table .table-header,
  .recent-records .card-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .data-table .table-actions,
  .recent-records .record-actions {
    width: 100%;
    flex-wrap: wrap;
  }
  
  /* 表格操作按钮优化 */
  .el-table .el-button--small {
    padding: 8px 12px;
    font-size: 12px;
  }
  
  /* 固定列阴影优化 */
  .el-table__fixed-right {
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
  }
}

/* 超小屏幕表格卡片化 */
@media (max-width: 480px) {
  /* 表格转卡片视图提示 */
  .el-table {
    font-size: 12px;
  }
  
  .el-table .cell {
    padding: 8px 6px;
  }
  
  /* 隐藏次要列 */
  .el-table .hide-on-mobile {
    display: none !important;
  }
}

/* =====================================================
   移动端对话框优化
   ===================================================== */
@media (max-width: 768px) {
  .el-dialog {
    width: 95% !important;
    max-width: 95vw !important;
    margin: 0 auto !important;
    border-radius: 16px;
  }
  
  .el-dialog__header {
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .el-dialog__title {
    font-size: 18px;
    font-weight: 600;
  }
  
  .el-dialog__body {
    padding: 20px;
    max-height: 60vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .el-dialog__footer {
    padding: 16px 20px;
    display: flex;
    flex-direction: column-reverse;
    gap: 10px;
  }
  
  .el-dialog__footer .el-button {
    width: 100%;
    margin: 0;
    height: 44px;
  }
}

/* 全屏对话框 - 超小屏幕 */
@media (max-width: 480px) {
  .el-dialog {
    width: 100% !important;
    max-width: 100vw !important;
    height: 100vh !important;
    max-height: 100vh !important;
    margin: 0 !important;
    border-radius: 0;
  }
  
  .el-dialog__body {
    max-height: calc(100vh - 140px);
  }
}

/* =====================================================
   移动端导航优化
   ===================================================== */
@media (max-width: 768px) {
  .sidebar-menu .el-menu-item,
  .sidebar-menu .menu-item {
    height: 52px;
    line-height: 52px;
    padding: 0 16px;
    font-size: 15px;
  }
  
  .sidebar-menu .el-menu-item i,
  .sidebar-menu .menu-item .icon {
    font-size: 20px;
    margin-right: 14px;
  }
  
  /* 底部导航优化 */
  .bottom-nav,
  .tactical-nav {
    padding-bottom: constant(safe-area-inset-bottom);
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* =====================================================
   移动端性能优化
   ===================================================== */
@media (max-width: 768px) {
  /* 使用GPU加速 */
  .card,
  .stat-card,
  .chart-container,
  .sidebar,
  .sidebar-drawer,
  .header-drawer {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }
  
  /* 减少重绘和回流 */
  .stats-grid,
  .chart-content,
  .metrics-grid {
    contain: layout style paint;
  }
  
  /* 优化阴影效果 - 减少复杂阴影 */
  .card,
  .stat-card,
  .glass-panel {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }
}

/* =====================================================
   移动端网络优化
   ===================================================== */
@media (max-width: 768px) {
  /* 减少HTTP请求 */
  .chart-container,
  .data-table {
    background-image: none !important;
  }
  
  /* 优化字体加载 */
  @font-face {
    font-display: swap;
  }
}

/* =====================================================
   移动端可访问性优化
   ===================================================== */
@media (max-width: 768px) {
  /* 高对比度模式 */
  @media (prefers-contrast: high) {
    .card,
    .stat-card,
    .glass-panel {
      border: 2px solid currentColor;
    }
    
    .el-button {
      border-width: 2px;
    }
  }
  
  /* 焦点指示器 - 增强可见性 */
  .el-button:focus-visible,
  .el-input:focus-within,
  .el-select:focus-within,
  .el-date-editor:focus-within {
    outline: 3px solid rgba(99, 102, 241, 0.6);
    outline-offset: 2px;
  }
  
  /* 跳过链接 */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: #6366f1;
    color: white;
    padding: 8px 16px;
    z-index: 10000;
    transition: top 0.3s;
  }
  
  .skip-link:focus {
    top: 0;
  }
}

/* =====================================================
   移动端卡片和概览优化
   ===================================================== */
@media (max-width: 768px) {
  /* 概览卡片网格 */
  .overview-cards .el-row,
  .stats-grid,
  .card-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .overview-cards .el-col,
  .stats-grid > *,
  .card-grid > * {
    width: 100% !important;
    max-width: 100% !important;
    flex: none !important;
    padding: 0 !important;
  }
  
  /* 概览卡片样式 */
  .overview-card,
  .stat-card {
    padding: 16px;
    flex-direction: row;
    align-items: center;
    gap: 16px;
  }
  
  .overview-card .card-icon,
  .stat-card .card-icon {
    flex-shrink: 0;
  }
  
  .overview-card .card-content,
  .stat-card .card-content {
    flex: 1;
    min-width: 0;
  }
  
  .overview-card .card-value,
  .stat-card .card-value {
    font-size: 1.5rem;
  }
}

/* =====================================================
   移动端图表优化
   ===================================================== */
@media (max-width: 768px) {
  .chart-section,
  .chart-card {
    margin-bottom: 16px;
  }
  
  .chart-container {
    height: 280px;
    padding: 12px;
  }
  
  .chart-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .chart-header h3 {
    font-size: 16px;
  }
}

/* =====================================================
   移动端分页优化
   ===================================================== */
@media (max-width: 768px) {
  .pagination-container {
    justify-content: center;
    padding: 16px 0;
  }
  
  .el-pagination {
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
  }
  
  .el-pagination .el-pagination__sizes,
  .el-pagination .el-pagination__jump {
    display: none;
  }
  
  .el-pagination .el-pager li {
    min-width: 36px;
    height: 36px;
    line-height: 36px;
  }
  
  .el-pagination button {
    min-width: 36px;
    height: 36px;
  }
}

/* =====================================================
   移动端页面头部优化
   ===================================================== */
@media (max-width: 768px) {
  .page-header {
    margin-bottom: 16px;
    padding: 0;
  }
  
  .page-header h1 {
    font-size: 20px;
    margin-bottom: 4px;
  }
  
  .page-description {
    font-size: 13px;
    line-height: 1.5;
  }
}

/* =====================================================
   安全区域适配 (iPhone X+)
   ===================================================== */
@supports (padding: max(0px)) {
  .app-container {
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
  }
  
  .floating-actions {
    bottom: max(16px, calc(env(safe-area-inset-bottom) + 16px));
    right: max(16px, env(safe-area-inset-right));
  }
  
  .tactical-nav,
  .bottom-nav {
    padding-bottom: max(8px, env(safe-area-inset-bottom));
  }
}