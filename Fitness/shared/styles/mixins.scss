// =============================================================================
// Mixins - 共享混入函数
// =============================================================================
// 供用户端和管理端使用的通用混入函数

@use 'sass:math';
@use 'variables' as *;
@use 'tokens' as tokens;

// =============================================================================
// 响应式断点混入
// =============================================================================

/// 移动端优先的媒体查询
/// @param {String} $breakpoint - 断点名称 (xs, sm, md, lg, xl, 2xl)
@mixin respond-to($breakpoint) {
  @if map-has-key($breakpoints, $breakpoint) {
    @media (min-width: map-get($breakpoints, $breakpoint)) {
      @content;
    }
  } @else {
    @warn "Unknown breakpoint: #{$breakpoint}";
  }
}

/// 最大宽度媒体查询
/// @param {String} $breakpoint - 断点名称
@mixin respond-below($breakpoint) {
  @if map-has-key($breakpoints, $breakpoint) {
    @media (max-width: map-get($breakpoints, $breakpoint) - 1px) {
      @content;
    }
  } @else {
    @warn "Unknown breakpoint: #{$breakpoint}";
  }
}

/// 范围媒体查询
/// @param {String} $min - 最小断点
/// @param {String} $max - 最大断点
@mixin respond-between($min, $max) {
  @if map-has-key($breakpoints, $min) and map-has-key($breakpoints, $max) {
    @media (min-width: map-get($breakpoints, $min)) and (max-width: map-get($breakpoints, $max) - 1px) {
      @content;
    }
  } @else {
    @warn "Unknown breakpoint(s): #{$min}, #{$max}";
  }
}

// =============================================================================
// Flexbox 混入
// =============================================================================

/// Flex 容器
/// @param {String} $direction - 方向 (row, column)
/// @param {String} $justify - 主轴对齐
/// @param {String} $align - 交叉轴对齐
@mixin flex($direction: row, $justify: flex-start, $align: stretch) {
  display: flex;
  flex-direction: $direction;
  justify-content: $justify;
  align-items: $align;
}

/// Flex 居中
@mixin flex-center {
  display: flex;
  justify-content: center;
  align-items: center;
}

/// Flex 两端对齐
@mixin flex-between {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

// =============================================================================
// 文本混入
// =============================================================================

/// 文本截断
/// @param {Number} $lines - 行数 (1 为单行截断)
@mixin text-truncate($lines: 1) {
  @if $lines == 1 {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  } @else {
    display: -webkit-box;
    -webkit-line-clamp: $lines;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}

/// 标题样式
/// @param {Number} $level - 标题级别 (1-4)
@mixin heading($level: 1) {
  font-family: tokens.$font-family-sans;
  
  @if $level == 1 {
    font-size: tokens.$font-size-4xl;
    font-weight: tokens.$font-weight-extrabold;
    line-height: tokens.$line-height-tight;
    letter-spacing: tokens.$letter-spacing-tight;
  } @else if $level == 2 {
    font-size: tokens.$font-size-3xl;
    font-weight: tokens.$font-weight-bold;
    line-height: tokens.$line-height-tight;
    letter-spacing: tokens.$letter-spacing-tight;
  } @else if $level == 3 {
    font-size: tokens.$font-size-2xl;
    font-weight: tokens.$font-weight-semibold;
    line-height: tokens.$line-height-snug;
  } @else if $level == 4 {
    font-size: tokens.$font-size-xl;
    font-weight: tokens.$font-weight-semibold;
    line-height: tokens.$line-height-snug;
  }
}

/// 正文样式
/// @param {String} $size - 尺寸 (sm, base, lg)
@mixin body-text($size: 'base') {
  font-family: tokens.$font-family-sans;
  font-weight: tokens.$font-weight-normal;
  letter-spacing: tokens.$letter-spacing-normal;
  
  @if $size == 'sm' {
    font-size: tokens.$font-size-sm;
    line-height: tokens.$line-height-normal;
  } @else if $size == 'lg' {
    font-size: tokens.$font-size-lg;
    line-height: tokens.$line-height-relaxed;
  } @else {
    font-size: tokens.$font-size-base;
    line-height: tokens.$line-height-relaxed;
  }
}

// =============================================================================
// 卡片混入
// =============================================================================

/// 卡片样式
/// @param {Boolean} $hover - 是否有悬停效果
@mixin card($hover: true) {
  background: $bg-card;
  border-radius: $border-radius-base;
  padding: tokens.$spacing-6;
  box-shadow: $shadow-base;
  transition: box-shadow $transition-time;
  
  @if $hover {
    &:hover {
      box-shadow: $shadow-light;
    }
  }
}

// =============================================================================
// 按钮混入
// =============================================================================

/// 按钮基础样式
@mixin button-base {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: tokens.$spacing-2 tokens.$spacing-4;
  border-radius: $border-radius-base;
  font-size: tokens.$font-size-sm;
  font-weight: tokens.$font-weight-medium;
  cursor: pointer;
  transition: all $transition-fast;
  border: 1px solid transparent;
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

/// 主要按钮样式
@mixin button-primary {
  @include button-base;
  background-color: $primary-color;
  border-color: $primary-color;
  color: $text-white;
  
  &:hover:not(:disabled) {
    background-color: darken($primary-color, 10%);
    border-color: darken($primary-color, 10%);
  }
}

/// 次要按钮样式
@mixin button-secondary {
  @include button-base;
  background-color: transparent;
  border-color: $border-color;
  color: $text-regular;
  
  &:hover:not(:disabled) {
    background-color: $bg-card;
    border-color: $primary-color;
  }
}

// =============================================================================
// 表单混入
// =============================================================================

/// 输入框样式
@mixin input-base {
  width: 100%;
  padding: tokens.$spacing-2 tokens.$spacing-3;
  background-color: $bg-card;
  border: 1px solid $border-color;
  border-radius: $border-radius-base;
  color: $text-primary;
  font-size: tokens.$font-size-base;
  transition: border-color $transition-fast;
  
  &::placeholder {
    color: $text-placeholder;
  }
  
  &:focus {
    outline: none;
    border-color: $primary-color;
  }
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

// =============================================================================
// 动画混入
// =============================================================================

/// 淡入动画
@mixin fade-in($duration: $transition-time) {
  animation: fadeIn $duration ease-in-out;
  
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
}

/// 滑入动画
/// @param {String} $direction - 方向 (up, down, left, right)
@mixin slide-in($direction: 'up', $duration: $transition-time) {
  @if $direction == 'up' {
    animation: slideInUp $duration ease-out;
    
    @keyframes slideInUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  } @else if $direction == 'down' {
    animation: slideInDown $duration ease-out;
    
    @keyframes slideInDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  }
}

// =============================================================================
// 工具混入
// =============================================================================

/// 清除浮动
@mixin clearfix {
  &::after {
    content: '';
    display: table;
    clear: both;
  }
}

/// 隐藏滚动条
@mixin hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
  
  &::-webkit-scrollbar {
    display: none;
  }
}

/// 绝对定位填充
@mixin absolute-fill {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}

/// 固定宽高比
/// @param {Number} $width - 宽度比例
/// @param {Number} $height - 高度比例
@mixin aspect-ratio($width, $height) {
  aspect-ratio: math.div($width, $height);
}
